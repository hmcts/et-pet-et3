language: ruby
cache:
  bundler: true
  directories:
  - tmp/parallel_runtime_log
env:
  global:
    - DB_PORT=5433
    - S3_PORT=9000
before_install:
  - chmod +x ./bin/wait-for-it.sh
before_script:
  - ./bin/dev/docker-support-services up -d
  - ./bin/wait-for-it.sh localhost:5433
  - sleep 5
  - ./bin/wait-for-it.sh localhost:5433
  - ./bin/wait-for-it.sh localhost:9000
  - bundle exec rake parallel:create parallel:migrate
script:
  - bundle exec rake parallel:spec
addons:
  chrome: stable
  firefox: latest
  postgresql: "9.6"
services:
  - postgresql